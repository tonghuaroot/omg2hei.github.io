<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> S3FS 简介及部署 · TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker.</title><meta name="description" content="S3FS 简介及部署 - TonghuaRoot"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://tonghuaroot.com/atom.xml" title="TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker."><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker." type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://twitter.com/tonghuaroot" target="_blank" class="nav-list-link">TWITTE</a></li><li class="nav-list-item"><a href="https://github.com/tonghuaroot" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">S3FS 简介及部署</h1><div class="post-info">Nov 17, 2019</div><div class="post-content"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>S3FS可以把S3 Bucket可以向挂盘一样，挂在本地，适用于Linux和Mac OS，完事复制粘贴写文件啥的跟普通的文件夹几乎没啥差别，体验很棒。<br>当然，也有一些缺点，这个后面再说。（如果你遇不到它，那就是没缺点，大雾hhh）</p>
<h2 id="0x01-实验环境"><a href="#0x01-实验环境" class="headerlink" title="0x01 实验环境"></a>0x01 实验环境</h2><ul>
<li>Amazon Linux 2</li>
</ul>
<h2 id="0x02-操作步骤"><a href="#0x02-操作步骤" class="headerlink" title="0x02 操作步骤"></a>0x02 操作步骤</h2><ol>
<li>安装<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo amazon-linux-extras install epel</span><br><span class="line">sudo yum install s3fs-fuse</span><br></pre></td></tr></table></figure></li>
<li>挂载<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s3fs s3fs-tonghua s3fs_local #（前面是桶名，后面是本地需要挂载到的目录）</span><br></pre></td></tr></table></figure>
如果向上面那么玩，你使用中国区的S3的话，那一定是不成功的。通过debug信息我们可以看到其把请求打到global去了，“那前朝的剑，斩本朝的官”，那自然是行不通的，我们要把region改到中国来。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s3fs s3fs-tonghua s3fs_local -o dbglevel=info -f -o curldbg # 开启debug日志</span><br></pre></td></tr></table></figure>
可以通过如下方式修改endpoint，可以看到已经成功了。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-0-64 /]# s3fs s3fs-tonghua s3fs_local -o url=https://s3.cn-north-1.amazonaws.com.cn                       [root@ip-10-0-0-64 /]# cd s3fs_local/</span><br><span class="line">[root@ip-10-0-0-64 s3fs_local]# ls</span><br><span class="line">test01_no_version.txt</span><br><span class="line">[root@ip-10-0-0-64 s3fs_local]#</span><br></pre></td></tr></table></figure>
这种情况下，如果我机器重启了，那挂载的S3就没了。所以我们要给他换成/etc/fstab，保证其重启后也无需重新下载。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 s3fs_local]$ cat /etc/fstab</span><br><span class="line">#</span><br><span class="line">UUID=8a9e0fcb-f415-4a3f-931d-919fadf8e22c     /           xfs    defaults,noatime  1   1</span><br><span class="line">s3fs#s3fs-tonghua /s3fs_local fuse _netdev,nonempty,allow_other,use_path_request_style,url=https://s3.cn-north-1.amazonaws.com.cn 0 0</span><br><span class="line">[ec2-user@ip-10-0-0-64 s3fs_local]$配置</span><br></pre></td></tr></table></figure>
以上就完成了S3FS的配置。</li>
</ol>
<h2 id="0x03-说说S3FS的利弊"><a href="#0x03-说说S3FS的利弊" class="headerlink" title="0x03 说说S3FS的利弊"></a>0x03 说说S3FS的利弊</h2><p>S3FS本质上是对象存储，其跟块存储还是有区别的，块存储我如果修改一个大文件的话，背后只修改对应的block，但是S3就不一样了，如果我传一个超大的文件，几个G或者T的，那他是会整个往S3传的，既费钱还有一致性的问题。<br>然后如果我读写频率太高的话，还容易被服务限制。<br>关于其缺点的话，官方文档说的也比较清楚了，我这头就不再赘述，有兴趣的同学可以去看看：<a href="https://github.com/s3fs-fuse/s3fs-fuse">https://github.com/s3fs-fuse/s3fs-fuse</a></p>
<h2 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h2><p>试了下S3FS，有的场景确实很方便，具体使用的话还是要结合自身业务场景，选择合适的数据传输、存储方式。</p>
<h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><ul>
<li><a href="https://github.com/s3fs-fuse/s3fs-fuse">FUSE-based file system backed by Amazon S3</a></li>
<li><a href="http://manpages.ubuntu.com/manpages/xenial/man1/s3fs.1.html">s3fs</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2019/11/19/AWS-ECS-Fargate/" class="prev">PREV</a><a href="/2019/11/15/AWS-EBS-UUID-EC2-Change-Instance-Type/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2024 <a href="https://tonghuaroot.com">TonghuaRoot</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>