<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> AWS VPC DHCP Options Set change Effective immediately · TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker.</title><meta name="description" content="AWS VPC DHCP Options Set change Effective immediately - TonghuaRoot"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://tonghuaroot.com/atom.xml" title="TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker."></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://twitter.com/tonghuaroot" target="_blank" class="nav-list-link">TWITTE</a></li><li class="nav-list-item"><a href="https://github.com/omg2hei" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">AWS VPC DHCP Options Set change Effective immediately</h1><div class="post-info">May 23, 2019</div><div class="post-content"><h2 id="0x00-TL-DR"><a href="#0x00-TL-DR" class="headerlink" title="0x00 TL;DR"></a>0x00 TL;DR</h2><p>Usually, after the DHCP Options Set changes, it takes several hours for the EC2 instance inside the VPC to use the new DHCP Options Set.<br>This article describes how to make the configuration of the DHCP Options Set take effect immediately in the specified EC2 instance.<br>The overall idea is to restart the EC2 instance network and let the DHCP service reassign network information.</p>
<h2 id="0x01-VPC-change-DHCP-Options-Set"><a href="#0x01-VPC-change-DHCP-Options-Set" class="headerlink" title="0x01 VPC change DHCP Options Set"></a>0x01 VPC change DHCP Options Set</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws ec2 associate-dhcp-options --dhcp-options-id dopt-06d6a444d7a288888 --vpc-id vpc-0614eddfdb8988888</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:After you associate a new set of DHCP options with a VPC, any existing instances and all new instances that you launch in the VPC use these options. You don’t need to restart or relaunch the instances. They automatically pick up the changes within a few hours, depending on how frequently the instance renews its DHCP lease. If you want, you can explicitly renew the lease using the operating system on the instance.</p>
</blockquote>
<h2 id="0x02-Set-DHCP-Options-Set-effect-immediately-in-specified-EC2-instance"><a href="#0x02-Set-DHCP-Options-Set-effect-immediately-in-specified-EC2-instance" class="headerlink" title="0x02 Set DHCP Options Set effect immediately in specified EC2 instance"></a>0x02 Set DHCP Options Set effect immediately in specified EC2 instance</h2><ul>
<li>Windows Server 2016 Renew DHCP Lease(ipconfig /renew):</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以太网适配器 以太网:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : cn-north-1.compute.internal</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::dd5d:2739:e78f:5566%14</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 10.0.0.39</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . : 10.0.0.1</span><br><span class="line"></span><br><span class="line">隧道适配器 isatap.cn-north-1.compute.internal:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line"></span><br><span class="line">隧道适配器 本地连接* 3:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   IPv6 地址 . . . . . . . . . . . . : 2001:0:348b:fb58:4f6:3e50:f5ff:ffd8</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::4f6:3e50:f5ff:ffd8%12</span><br><span class="line">   默认网关. . . . . . . . . . . . . : ::</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;ipconfig /renew</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以太网适配器 以太网:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : corp.tonghua.com</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::dd5d:2739:e78f:5566%14</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 10.0.0.39</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . : 10.0.0.1</span><br><span class="line"></span><br><span class="line">隧道适配器 本地连接* 3:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line"></span><br><span class="line">隧道适配器 isatap.corp.tonghua.com:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>Amazon Linux 2 Renew DHCP Lease(sudo service network restart):</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-10-0-0-64 ~]$ cat /var/lib/dhclient/dhclient--eth0.lease</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 13:35:11;</span><br><span class="line">  rebind 4 2019/05/23 14:02:11;</span><br><span class="line">  expire 4 2019/05/23 14:09:41;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 13:36:56;</span><br><span class="line">  rebind 4 2019/05/23 14:02:23;</span><br><span class="line">  expire 4 2019/05/23 14:09:53;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:00:23;</span><br><span class="line">  rebind 4 2019/05/23 14:29:26;</span><br><span class="line">  expire 4 2019/05/23 14:36:56;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:29:09;</span><br><span class="line">  rebind 4 2019/05/23 14:52:53;</span><br><span class="line">  expire 4 2019/05/23 15:00:23;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:56:39;</span><br><span class="line">  rebind 4 2019/05/23 15:21:39;</span><br><span class="line">  expire 4 2019/05/23 15:29:09;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ sudo service network restart</span><br><span class="line">Restarting network (via systemctl):                        [  OK  ]</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$ cat /var/lib/dhclient/dhclient--eth0.lease</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option domain-name-servers 10.0.0.2;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;cn-north-1.compute.internal&quot;;</span><br><span class="line">  renew 4 2019/05/23 14:56:39;</span><br><span class="line">  rebind 4 2019/05/23 15:21:39;</span><br><span class="line">  expire 4 2019/05/23 15:29:09;</span><br><span class="line">&#125;</span><br><span class="line">lease &#123;</span><br><span class="line">  interface &quot;eth0&quot;;</span><br><span class="line">  fixed-address 10.0.0.64;</span><br><span class="line">  option subnet-mask 255.255.255.0;</span><br><span class="line">  option routers 10.0.0.1;</span><br><span class="line">  option dhcp-lease-time 3600;</span><br><span class="line">  option dhcp-message-type 5;</span><br><span class="line">  option domain-name-servers 10.0.1.101,10.0.3.86;</span><br><span class="line">  option dhcp-server-identifier 10.0.0.1;</span><br><span class="line">  option interface-mtu 9001;</span><br><span class="line">  option broadcast-address 10.0.0.255;</span><br><span class="line">  option host-name &quot;ip-10-0-0-64&quot;;</span><br><span class="line">  option domain-name &quot;corp.tonghua.com&quot;;</span><br><span class="line">  renew 4 2019/05/23 15:14:34;</span><br><span class="line">  rebind 4 2019/05/23 15:39:02;</span><br><span class="line">  expire 4 2019/05/23 15:46:32;</span><br><span class="line">&#125;</span><br><span class="line">[ec2-user@ip-10-0-0-64 ~]$</span><br></pre></td></tr></table></figure>
<h2 id="0x03-Reference"><a href="#0x03-Reference" class="headerlink" title="0x03 Reference"></a>0x03 Reference</h2><ul>
<li><a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/VPC_DHCP_Options.html" target="_blank" rel="noopener">DHCP Options Sets</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/associate-dhcp-options.html#examples" target="_blank" rel="noopener">associate-dhcp-options</a></li>
<li><a href="https://kb.wisc.edu/page.php?id=562" target="_blank" rel="noopener">WINDOWS - DISPLAYING, RELEASING AND RENEWING A DHCP LEASE</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2019/05/28/Use-AWS-SSM-Systems-Manager-execute-remote-script-file-at-EC2-instance/" class="prev">PREV</a><a href="/2019/05/23/How-do-I-set-the-S3-bucket-policy-so-that-it-can-only-be-accessed-by-the-specified-IP/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2020 <a href="https://tonghuaroot.com">TonghuaRoot</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>